# 更新日志

## v1.0.0 (2026-01-03)

### 🔒 安全增强

#### 照片删除保护
- 新增照片删除前的叙事关联校验功能
- 如果照片已关联到叙事（Story），将无法直接删除
- 删除确认对话框会显示关联的叙事列表
- 用户需要先从叙事中移除这些照片，然后再删除

---

### ✨ 新功能 (2026-01-02)

#### 叙事系统增强
- 叙事列表采用非对称网格布局重新设计
- 快速编辑器中添加文件重排序功能
- 嵌入快速创建工具入口
- 新增叙事预览模态框，支持画廊和灯箱效果

#### 管理后台改进
- 上传表单增强：分类可选，显示存储路径
- 相册工具栏重新设计，支持可折叠筛选器
- 精选照片切换 UX 改进
- 照片详情面板显示存储路径
- Tab 组件与路由页面整合

#### 编辑器优化
- Milkdown 编辑器添加浅色模式文字颜色覆盖

#### 部署配置
- Docker 配置添加中国镜像仓库支持
- 简化并重组 .env.example 配置文件

---

### 📝 变更详情

#### 后端 API
- 新增 `GET /api/admin/photos/:id/stories` - 查询单张照片关联的叙事
- 新增 `POST /api/admin/photos/check-stories` - 批量检查多张照片的叙事关联
- 修改 `DELETE /api/admin/photos/:id` - 删除前检查叙事关联，如有关联返回错误

#### 前端
- 修改删除确认对话框，支持显示关联叙事警告
- 添加加载状态显示
- 如果有关联叙事，仅显示取消按钮，阻止删除操作

#### 国际化
- 添加中英文提示文本支持

---

### 🛠 技术细节

**修改的文件：**
- `hono/photos.ts` - 后端 API 逻辑
- `src/lib/api.ts` - 前端 API 调用
- `src/components/admin/DeleteConfirmDialog.tsx` - 删除确认对话框组件
- `src/app/admin/layout.tsx` - 管理后台布局逻辑
- `src/lib/i18n.ts` - 国际化文本

**数据库关系：**
- 利用现有的 Photo-Story 多对多关系 (`stories Story[] @relation("PhotoStories")`)